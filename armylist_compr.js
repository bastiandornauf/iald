var units=new Array();var armylistContent=JSON.parse(dumpArmyAsText());$(document).ready(function(){if(localStorage.getItem("iald.displayWeapons")==null)localStorage.setItem("iald.displayWeapons","true");if(localStorage.getItem("iald.displayEdit")==null)localStorage.setItem("iald.displayEdit","false");data=localStorage.getItem("iald.army");if(data==null)data=dumpArmyAsText();armylistContent=JSON.parse(data);updateHTML(true);registerEvents()});function updateHTML(a){var d=document;d.getElementById("armylist").innerHTML=updateArmyList(a);hideUnitWpn(toBoolean(localStorage.getItem("iald.displayWeapons")));hideLoadbox(toBoolean(localStorage.getItem("iald.displayEdit")))}function registerEvents(){$("button").click(performClick);$("#wbtn").click(tglWeapons);$("#lbtn").click(performLoadClick)}function performClick(){var a=true;var b=$(this).attr('id');if(b=="reset"){armylistContent=JSON.parse(dumpArmyAsText());localStorage.setItem("iald.army",dumpArmyAsText());a=true}else if(b=="download"){onDownload()}else{var c=parseInt(b.substring(4));if(units.length>0)units[c].alive=!units[c].alive;localStorage.setItem("iald.army",JSON.stringify(units))}updateHTML(a);registerEvents()}function performLoadClick(){var a=localStorage;display=!toBoolean(a.getItem("iald.displayEdit"));a.setItem("iald.displayEdit",display.toString());if(!display){armylistContent=JSON.parse(document.getElementById("armyImport").value);a.setItem("iald.army",JSON.stringify(armylistContent));updateHTML(true)}else updateHTML(false);registerEvents()}function hideUnitWpn(a){var d=document;if(a){$(".weapondata").show();d.getElementById("wbtn").innerHTML="hide wpn"}else{$(".weapondata").hide();d.getElementById("wbtn").innerHTML="show wpn"}var b=d.getElementsByClassName("unitWpn");for(var c=0;c<b.length;c++)b[c].hidden=a}function hideLoadbox(a){var d=document;if(a){$("#loadbox").show();d.getElementById("lbtn").innerHTML="update army"}else{$("#loadbox").hide();d.getElementById("lbtn").innerHTML="edit army"}}function toBoolean(a){return String(a).toLowerCase()==='true'}function tglWeapons(){var a=localStorage;var b=!toBoolean(a.getItem("iald.displayWeapons"));a.setItem("iald.displayWeapons",b.toString());hideUnitWpn(b)}function tglLoad(){var a=localStorage;var b=!toBoolean(a.getItem("iald.displayEdit"));a.setItem("iald.displayEdit",b.toString());hideLoadbox(b)}function loadUnits(){return armylistContent}function updateArmyList(a){var b={"activePts":0,"pts":0,"swc":0,"units":0,"activeUnits":0}var c=new Array();units=loadUnits();for(var d=0;d<units.length;d++){c.push(htmlUnit(units[d],b,d))}return htmlListOpen(b)+c.join(" ")}function htmlListOpen(a){var b=a.pts*0.4;console.log(b);var c=a.activeUnits+"/"+a.units+" models, "+a.activePts+"/"+a.pts+"pts, "+a.swc+"SWC &mdash; break at "+Math.floor(b);console.log(c);if(a.activePts<=0)c="<span class='red'>ANNIHILATED! "+c+"</span>";else if(a.activePts<=b)c="<span class='red'>RETREAT! "+c+"</span>";return'<div class="top"><span class="clear" id="lbtn" title="open army editor">edit army</span><span class="clear" id="wbtn" title="toggle verbose weapon display">hide wpns</span>'+'<div class="screen">'+c+'</div></div>'+'<div id="loadbox">Enter the army list here, its has to be formatted as JSON. If you enter invalid JSON your changes will get lost (click several time on updateArmy-button until it works again ;) I am planning to allow a much more convenient method of data entry, but for now this should work.<br>The reset-button loads a default army list - be careful, there is no safety question. Download allows you to save the army data as text file.<br>'+'<textarea id="armyImport" rows="10" cols="60">'+JSON.stringify(armylistContent,null,"\t")+'</textarea><br>'+'<button id="reset" title="reset army to example">reset</button>'+'<button id="download" title="download current army as text file">download</button></div>'}function onDownload(){document.location='data:Application/octet-stream;filename=armylist.txt,'+encodeURIComponent(localStorage.getItem("iald.army"))}function htmlUnit(a,b,c){if(typeof a=="string"){return"<h1>"+a+"</h1>"}else{name=a.spec;type=a.type;pts=a.pts;swc=a.swc;mov=a.mov;cc=a.cc;bs=a.bs;ph=a.ph;wip=a.wip;arm=a.arm;bts=a.bts;w=a.w;props=a.props.split(",");weapons=a.weapons.split(",");active=a.alive;if(a.regular)icons="<a href = 'http://infinitythegame.wikispot.org/Instruction?action=show' class='imgLink'><img src='icons/regular_icon.png' width='24px' height='24px'></a>";else icons="<a href = 'http://infinitythegame.wikispot.org/Instruction?action=show' class='imgLink'><img src='icons/irregular_icon.png' width='24px' height='24px'></a>";if(a.impetuous)icons+=" <a href = 'http://infinitythegame.wikispot.org/Fury?action=show' class='imgLink'><img src='icons/impetuous_icon.png' width='24px' height='24px'></a> ";if(active){b.activePts+=pts;b.activeUnits++}b.pts+=pts;b.swc+=swc;b.units++;var d="";if(!active)d+='<div class="inactive" id="act'+c+'">';else{d+='<div class="active" id="act'+c+'">'}d+='<div class="unit"><div class="unitName">';button='<button title="toggle status of this unit" id="unit'+c+'">'+b.units+'</button>';d+='<div class="unitCost">'+type+' '+pts+'pts '+swc+'SWC</div>'+button+name;if(active){d+="</div>";if("header"in a)d+="<h2>"+a.header+"</h2>";d+=statBox(mov,cc,bs,ph,wip,arm,bts,w,1);if("secondStatLine"in a){d+="<h2 class='second'>"+a.secondStatLine.header+"</h2>";d+=statBox(a.secondStatLine.mov,a.secondStatLine.cc,a.secondStatLine.bs,a.secondStatLine.ph,a.secondStatLine.wip,a.secondStatLine.arm,a.secondStatLine.bts,a.secondStatLine.w,.5)}propLinks=new Array();for(var c=0;c<props.length;c++){propLinks.push('<a href="http://infinitythegame.wikispot.org/'+props[c].trim()+'">'+props[c]+'</a>')}d+='<div class="unitProps">'+icons+' '+propLinks.join(' ')+'</div>';wpnLinks=new Array();for(var c=0;c<weapons.length;c++){wpnLinks.push('<a href="http://infinitythegame.wikispot.org/'+weapons[c].trim()+'">'+weapons[c]+'</a>')}d+='<div class="unitWpn">'+wpnLinks.join(' ')+'</div>';d+='<table class="weapondata"><tr>'+'<th>Weapon</th>'+'<th>Dmg</th>'+'<th>B</th>'+'<th>Ammo</th>'+'<th>Template</th>'+'<th class="value">S</th><th class="value">M</th><th class="value">L</th><th class="value">Max</th>'+'<th>Notes</th></tr>';for(var c=0;c<weapons.length;c++){var e=weapons[c];d+='<tr><td>'+wpnLinks[c]+'</td>'+htmlWeapon(e)+'</tr>'}d+='</table>'}else{d+=" &mdash; Out Of Action! </div> "}d+='</div>';d+='</div>\n\n';return d}}function statBox(a,b,c,d,e,f,g,h,i){var j="";j+="<table style='opacity:"+i+";"+"'><tr>";j+="<th class='isc'>mov</th>";j+="<th class='isc'>cc</th>";j+="<th class='isc'>bs</th>";j+="<th class='isc'>ph</th>";j+="<th class='isc'>wip</th>";j+="<th class='isc'>arm</th>";j+="<th class='isc'>bts</th>";j+="<th class='isc'>w</th>";j+="</tr>";j+='<tr>';j+='<td class="stats">'+(a)+'</td>';j+='<td class="stats">'+(b)+'</td>';j+='<td class="stats">'+(c)+'</td>';j+='<td class="stats">'+(d)+'</td>';j+='<td class="stats">'+(e)+'</td>';j+='<td class="stats">'+(f)+'</td>';j+='<td class="stats">'+fmt(bts)+'</td>';j+='<td class="stats">'+(h)+'</td>';j+='</tr></table>';return j}function htmlWeapon(a){var b=$.grep(data_weapons,function(e){return e.name.trim().toLowerCase()==a.trim().toLowerCase()});if(b.length==0){console.log("weapon %s was not found.",a);return"<td colspan='9'>weapon data not found.</td>"}else if(b.length==1){weapon=b[0];var c="";c+="<td class='wpnStats'>"+optOP(weapon.damage)+"</td>";c+="<td class='wpnStats'>"+optOP(weapon.burst)+"</td>";if(weapon.ammo.indexOf("/")==-1)c+="<td class='wpnStatsS'><a href='http://infinitythegame.wikispot.org/"+weapon.ammo+"''>"+weapon.ammo+"</a></td>";else{console.log("Found /: "+weapon.ammo);var d=weapon.ammo.split("/");c+="<td class='wpnStatsS'>";for(var f=0;f<d.length;f++){c+="<a href='http://infinitythegame.wikispot.org/"+d[f]+"''>"+d[f]+"</a>";if(f<d.length-1)c+="/"}c+="</td>"}c+="<td class='wpnStatsS'>"+weapon.template+"</td>";c+="<td class='wpnStats' "+tdCol(weapon.short_mod)+">"+slash(weapon.short_dist,weapon.short_mod)+"</td>";c+="<td class='wpnStats' "+tdCol(weapon.medium_mod)+">"+slash(weapon.medium_dist,weapon.medium_mod)+"</td>";c+="<td class='wpnStats' "+tdCol(weapon.long_mod)+">"+slash(weapon.long_dist,weapon.long_mod)+"</td>";c+="<td class='wpnStats' "+tdCol(weapon.max_mod)+">"+slash(weapon.max_dist,weapon.max_mod)+"</td>";var g=new Array();if(weapon.em_vul=="Yes")g.push("E/M vuln.");if(weapon.cc=="Yes")g.push("in CC");if(weapon.note!="")g.push(weapon.note);c+="<td>"+g.toString()+"</td>";return c}else{console.log("multiple weapons found: %o",b)}}function slash(a,b){a=optOP(a);b=fmt(b);if(a=="-"&&b==="-")return"&ndash;";else return a+"/"+b}function tdCol(a){if(a>=3)return"style='background-color:#6c3'";if(a>-3&&a<3)return"style='background-color:#ff6;'";if(a<=-3&&a>-6)return"style='background-color:#f93;'";if(a<=-6)return"style='background-color:#f33;'"}function fmt(a){if(a>0)return"+"+a;else if(a<0)return"&minus;"+Math.abs(a);else return optOP(a)}function optOP(a){if(a=="--")a="&ndash;";return a}function dumpArmyAsText(){return'[\r\n  \"triad 1\",\r\n  {\r\n    \"spec\": \"Sakiel - Viral\",\r\n    \"header\": \"active symbiont armor\",\r\n    \"regular\": true,\r\n    \"impetuous\": true,\r\n    \"type\": \"LI\",\r\n    \"pts\": 26,\r\n    \"swc\": 0,\r\n    \"mov\": \"4-4\",\r\n    \"cc\": 14,\r\n    \"bs\": 12,\r\n    \"ph\": 11,\r\n    \"wip\": 13,\r\n    \"arm\": 2,\r\n    \"bts\": 0,\r\n    \"w\": 1,\r\n    \"props\": \"Cube, Fireteam: Tohaa, Impetuous, Symbiont Armour, V: Courage\",\r\n    \"weapons\": \"Viral Combi Rifle, Swarm Grenades, Pistol, Knife\",\r\n    \"secondStatLine\": {\r\n      \"header\": \"inactive symbiont armor\",\r\n      \"mov\": \"4-4\",\r\n      \"bs\": 12,\r\n      \"cc\": 14,\r\n      \"ph\": 11,\r\n      \"wip\": 13,\r\n      \"arm\": 0,\r\n      \"bts\": 0,\r\n      \"w\": 1\r\n    },\r\n    \"alive\": true\r\n  },\r\n  {\r\n    \"spec\": \"Kamael - Combi\",\r\n    \"regular\": true,\r\n    \"impetuous\": false,\r\n    \"type\": \"LI\",\r\n    \"pts\": 12,\r\n    \"swc\": 0,\r\n    \"mov\": \"4-4\",\r\n    \"cc\": 13,\r\n    \"bs\": 11,\r\n    \"ph\": 11,\r\n    \"wip\": 13,\r\n    \"arm\": 1,\r\n    \"bts\": 0,\r\n    \"w\": 1,\r\n    \"props\": \"Cube, Fireteam: Tohaa\",\r\n    \"weapons\": \"Combi Rifle, Pistol, Knife\",\r\n    \"alive\": true\r\n  },\r\n  {\r\n    \"spec\": \"Kamael - Combi\",\r\n    \"regular\": true,\r\n    \"impetuous\": false,\r\n    \"type\": \"LI\",\r\n    \"pts\": 12,\r\n    \"swc\": 0,\r\n    \"mov\": \"4-4\",\r\n    \"bs\": 13,\r\n    \"cc\": 11,\r\n    \"ph\": 11,\r\n    \"wip\": 13,\r\n    \"arm\": 1,\r\n    \"bts\": 0,\r\n    \"w\": 1,\r\n    \"props\": \"Cube, Fireteam: Tohaa\",\r\n    \"weapons\": \"Combi Rifle, Pistol, Knife\",\r\n    \"alive\": true\r\n  },\r\n  \"triad 2\",\r\n  {\r\n    \"spec\": \"Makaul - Swarm\",\r\n    \"regular\": true,\r\n    \"impetuous\": true,\r\n    \"type\": \"WB\",\r\n    \"pts\": 18,\r\n    \"swc\": 0,\r\n    \"mov\": \"4-4\",\r\n    \"cc\": 19,\r\n    \"bs\": 11,\r\n    \"ph\": 13,\r\n    \"wip\": 13,\r\n    \"arm\": 1,\r\n    \"bts\": -3,\r\n    \"w\": 1,\r\n    \"props\": \"Cube, Fireteam: Tohaa, Impetuous, Martial Arts L2, i-Kohl L1\",\r\n    \"weapons\": \"Swarm Grenades, Zero-V Smoke Grenades, Heavy Flamethrower, Pistol, Viral CCW\",\r\n    \"alive\": true\r\n  },\r\n  {\r\n    \"spec\": \"Makaul - Flamer\",\r\n    \"regular\": true,\r\n    \"impetuous\": true,\r\n    \"type\": \"WB\",\r\n    \"pts\": 15,\r\n    \"swc\": 0,\r\n    \"mov\": \"4-4\",\r\n    \"cc\": 19,\r\n    \"bs\": 11,\r\n    \"ph\": 13,\r\n    \"wip\": 13,\r\n    \"arm\": 1,\r\n    \"bts\": -3,\r\n    \"w\": 1,\r\n    \"props\": \"Cube, Fireteam: Tohaa, Impetuous, Martial Arts L2, i-Kohl L1\",\r\n    \"weapons\": \"Zero-V Smoke Grenades, Heavy Flamethrower, Pistol, Viral CCW\",\r\n    \"alive\": true\r\n  },\r\n  {\r\n    \"spec\": \"Makaul - Flamer\",\r\n    \"regular\": true,\r\n    \"impetuous\": true,\r\n    \"type\": \"WB\",\r\n    \"pts\": 15,\r\n    \"swc\": 0,\r\n    \"mov\": \"4-4\",\r\n    \"cc\": 19,\r\n    \"bs\": 11,\r\n    \"ph\": 13,\r\n    \"wip\": 13,\r\n    \"arm\": 1,\r\n    \"bts\": -3,\r\n    \"w\": 1,\r\n    \"props\": \"Cube, Fireteam: Tohaa, Impetuous, Martial Arts L2, i-Kohl L1\",\r\n    \"weapons\": \"Zero-V Smoke Grenades, Heavy Flamethrower, Pistol, Viral CCW\",\r\n    \"alive\": true\r\n  },\r\n  \"loner\",\r\n  {\r\n    \"spec\": \"Ectros - Lt\",\r\n    \"header\": \"active symbiont armor\",\r\n    \"regular\": true,\r\n    \"impetuous\": false,\r\n    \"type\": \"HI\",\r\n    \"pts\": 50,\r\n    \"swc\": 0,\r\n    \"mov\": \"4-4\",\r\n    \"cc\": 17,\r\n    \"bs\": 13,\r\n    \"ph\": 14,\r\n    \"wip\": 13,\r\n    \"arm\": 3,\r\n    \"bts\": -6,\r\n    \"w\": 2,\r\n    \"props\": \"Cube, Fireteam: Tohaa, Poison, Symbiont Armor\",\r\n    \"weapons\": \"Viral Combi Rifle, Nanopulser, Pistol, CCW\",\r\n    \"secondStatLine\": {\r\n      \"header\": \"inactive symbiont armor\",\r\n      \"mov\": \"4-4\",\r\n      \"cc\": 17,\r\n      \"bs\": 12,\r\n      \"ph\": 11,\r\n      \"wip\": 13,\r\n      \"arm\": 0,\r\n      \"bts\": 0,\r\n      \"w\": 1\r\n    },\r\n    \"alive\": true\r\n  },\r\n  {\r\n    \"spec\": \"Chaksa - HMG\",\r\n    \"regular\": true,\r\n    \"impetuous\": false,\r\n    \"type\": \"LI\",\r\n    \"pts\": 25,\r\n    \"swc\": 1,\r\n    \"mov\": \"4-4\",\r\n    \"cc\": 14,\r\n    \"bs\": 11,\r\n    \"ph\": 12,\r\n    \"wip\": 13,\r\n    \"arm\": 0,\r\n    \"bts\": 0,\r\n    \"w\": 1,\r\n    \"props\": \"Poison, V: Courage, 360\u00B0 Visor, Neurocinetics\",\r\n    \"weapons\": \"HMG, Pistol, CCW\",\r\n    \"alive\": true\r\n  },\r\n  {\r\n    \"spec\": \"Chaksa - HMG\",\r\n    \"regular\": true,\r\n    \"impetuous\": false,\r\n    \"type\": \"LI\",\r\n    \"pts\": 25,\r\n    \"swc\": 1,\r\n    \"mov\": \"4-4\",\r\n    \"cc\": 14,\r\n    \"bs\": 11,\r\n    \"ph\": 12,\r\n    \"wip\": 13,\r\n    \"arm\": 0,\r\n    \"bts\": 0,\r\n    \"w\": 1,\r\n    \"props\": \"Poison, V: Courage, 360\u00B0 Visor, Neurocinetics\",\r\n    \"weapons\": \"HMG, Pistol, CCW\",\r\n    \"alive\": true\r\n  }\r\n]'}